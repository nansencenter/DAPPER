"""Test data loading and presentation functionality."""
##

import sys
import dapper as dpr
import inspect
from dataclasses import dataclass
import functools

# Capture stdout
import io
from contextlib import redirect_stdout
# https://stackoverflow.com/a/22434594
def cap_stdout(fun, *args, **kwargs):
    """Capture stdout."""
    with io.StringIO() as stringbuf, redirect_stdout(stringbuf):
        fun(*args, **kwargs)
        return stringbuf.getvalue()

##
if "--replace" in sys.argv:

    @dataclass
    class Replacement:
        lines  : list
        nOpen  : int
        nClose : int

    replacements = []
    orig_code = open(__file__,"r").readlines()

    def backtrack_until_finding(substr,lineno):
        while True:
            lineno -= 1
            if substr in orig_code[lineno]:
                return lineno

else:
    # Dyanmically add test_funcs to locals().
    test_register = locals()
    test_ind = 0

@functools.wraps(dpr.xpSpace.print)
def _print(xp_dict,*args,**kwargs):
    """Test xpSpace.print().

    sys.argv options:
        --replace : update this file (i.e. its data) 
        --print   : turn _print into xpSpace.print().

    Features:
    - Enables re-use of ``old`` variable name (by capturing its value).
    - Parameterization -- pytest.mark.parametrize not used.
                          Avoids having to decorate an explicit function
                          (and thus enables naming functions through test_ind).
    - Capturing stdout -- xpSpace.print() only called once for each ``old``
                          (unlike a pytest fixture with capsys) => fast.
    - splitlines() included.

    Obsolete?:
        the strip() functionality is used to remove bothersome trailing whitespaces
        (usually not printed by terminal, and so not copied when doing it manually)
    """

    # Get stdout of xpSpace.print()
    output = cap_stdout(xp_dict.print, *args, **kwargs)

    if "--print" in sys.argv:
        print(output)
        return
    else:
        output = output.splitlines(True)

    if "--replace" in sys.argv:
        caller_lineno = inspect.currentframe().f_back.f_lineno
        nClose = backtrack_until_finding('"""\n', caller_lineno)
        nOpen  = backtrack_until_finding('"""', nClose)
        replacements.append(Replacement(output,nOpen,nClose))

    else: # Generate & register tests
        global test_ind
        test_ind += 1

        # Capture ``old``
        _old = old.splitlines(True) # keepends

        # Loop over rows
        for lineno, (old_bound,new_bound) in enumerate(zip(_old,output)):

            # Define test function.
            def compare(old_line=old_bound,new_line=new_bound):
                assert old_line == new_line
                # assert old_line.strip() == new_line.strip()

            # Register test
            test_register[f'test_{test_ind}_line_{lineno}'] = compare


##
save_as = dpr.rc.dirs.DAPPER / "dpr_data" / "test_data"
xps = dpr.load_xps(save_as)
xps = dpr.xpSpace.from_list(xps)

xps_shorter = dpr.xpSpace.from_list([xp for xp in xps.values()
    if getattr(xp,'da_method')!='LETKF'])

##
old = """Averages (in time and) over seed.

[43mTable for da_method='Climatology'[0m
 F  â‘Š   rmse.a Â±1Ïƒ     â˜  âœ“
--  -  -------------------
 8  |  0.7775  Â±0.0005 0 2
10  |  0.97285 Â±0.0005 0 2

[43mTable for da_method='OptInterp'[0m
 F  â‘Š  rmse.a Â±1Ïƒ   â˜  âœ“
--  -  ----------------
 8  |   0.145 Â±0.05 0 2
10  |   0.145 Â±0.05 0 2

[43mTable for da_method='Var3D'[0m
 F   xB  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“
--  ---  -  -----------------
 8  0.1  |  0.1752 Â±0.004 0 2
 8  0.2  |  0.2742 Â±0.006 0 2
 8  0.4  |  0.3918 Â±0.006 0 2
10  0.1  |  0.1824 Â±0.006 0 2
10  0.2  |  0.2816 Â±0.008 0 2
10  0.4  |  0.3976 Â±0.007 0 2

[43mTable for da_method='EnKF'[0m
                      ________N=10_______  ________20_______  ________50_______
 F  upd_a    infl  â‘Š   rmse.a Â±1Ïƒ     â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
--  -------  ----  -  -------------------  -----------------  -----------------
 8  PertObs  1.01  |  0.0325  Â±0.005  0 2  0.031  Â±0.005 0 2   0.03  Â±0.005 0 2
 8  PertObs  1.1   |  0.0335  Â±0.005  0 2  0.031  Â±0.005 0 2   0.03  Â±0.005 0 2
 8  PertObs  2     |  0.18836 Â±0.0002 0 2  0.232  Â±0.02  0 2   0.294 Â±0.02  0 2
10  PertObs  1.01  |  0.034   Â±0.005  0 2  0.0325 Â±0.005 0 2   0.032 Â±0.005 0 2
10  PertObs  1.1   |  0.036   Â±0.005  0 2  0.033  Â±0.006 0 2   0.032 Â±0.005 0 2
10  PertObs  2     |  0.1892  Â±0.004  0 2  0.236  Â±0.02  0 2   0.302 Â±0.02  0 2
 8  Sqrt     1.01  |  0.0325  Â±0.005  0 2  0.031  Â±0.005 0 2   0.03  Â±0.005 0 2
 8  Sqrt     1.1   |  0.0335  Â±0.005  0 2  0.031  Â±0.005 0 2   0.03  Â±0.005 0 2
 8  Sqrt     2     |  0.214   Â±0.01   0 2  0.2646 Â±0.007 0 2   0.323 Â±0.01  0 2
10  Sqrt     1.01  |  0.0345  Â±0.005  0 2  0.0325 Â±0.005 0 2   0.032 Â±0.005 0 2
10  Sqrt     1.1   |  0.0354  Â±0.006  0 2  0.033  Â±0.005 0 2   0.032 Â±0.005 0 2
10  Sqrt     2     |  0.217   Â±0.01   0 2  0.268  Â±0.008 0 2   0.329 Â±0.01  0 2

[43mTable for da_method='EnKF_N'[0m
       _______N=10______  ________20_______  ________50_______
 F  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
--  -  -----------------  -----------------  -----------------
 8  |  0.0325 Â±0.005 0 2   0.031 Â±0.005 0 2   0.03  Â±0.005 0 2
10  |  0.0345 Â±0.005 0 2   0.033 Â±0.005 0 2   0.032 Â±0.005 0 2

[43mTable for da_method='LETKF'[0m
                      _______N=10______  ________20_______  ________50_______
 F  infl  loc_rad  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
--  ----  -------  -  -----------------  -----------------  -----------------
 8  1.01        1  |  0.0325 Â±0.005 0 2  0.031  Â±0.005 0 2  0.03   Â±0.005 0 2
 8  1.01        4  |  0.032  Â±0.005 0 2  0.031  Â±0.005 0 2  0.03   Â±0.005 0 2
 8  1.01       10  |  0.032  Â±0.005 0 2  0.031  Â±0.005 0 2  0.03   Â±0.005 0 2
 8  1.01       40  |  0.0325 Â±0.005 0 2  0.031  Â±0.005 0 2  0.03   Â±0.005 0 2
 8  1.1         1  |  0.032  Â±0.005 0 2  0.031  Â±0.005 0 2  0.03   Â±0.005 0 2
 8  1.1         4  |  0.0325 Â±0.005 0 2  0.031  Â±0.005 0 2  0.03   Â±0.005 0 2
 8  1.1        10  |  0.0325 Â±0.005 0 2  0.0305 Â±0.005 0 2  0.03   Â±0.005 0 2
 8  1.1        40  |  0.033  Â±0.005 0 2  0.031  Â±0.005 0 2  0.03   Â±0.005 0 2
 8  2           1  |  0.323  Â±0.01  0 2  0.325  Â±0.01  0 2  0.333  Â±0.009 0 2
 8  2           4  |  0.2886 Â±0.006 0 2  0.313  Â±0.01  0 2  0.33   Â±0.01  0 2
 8  2          10  |  0.2282 Â±0.007 0 2  0.2751 Â±0.001 0 2  0.321  Â±0.01  0 2
 8  2          40  |  0.213  Â±0.01  0 2  0.2639 Â±0.007 0 2  0.323  Â±0.01  0 2
10  1.01        1  |  0.034  Â±0.005 0 2  0.033  Â±0.005 0 2  0.032  Â±0.005 0 2
10  1.01        4  |  0.034  Â±0.005 0 2  0.0325 Â±0.005 0 2  0.0315 Â±0.005 0 2
10  1.01       10  |  0.034  Â±0.005 0 2  0.0325 Â±0.005 0 2  0.0315 Â±0.005 0 2
10  1.01       40  |  0.034  Â±0.005 0 2  0.0325 Â±0.005 0 2  0.032  Â±0.005 0 2
10  1.1         1  |  0.034  Â±0.005 0 2  0.0325 Â±0.005 0 2  0.0315 Â±0.005 0 2
10  1.1         4  |  0.0345 Â±0.005 0 2  0.0325 Â±0.005 0 2  0.0315 Â±0.005 0 2
10  1.1        10  |  0.0345 Â±0.005 0 2  0.0325 Â±0.005 0 2  0.0315 Â±0.005 0 2
10  1.1        40  |  0.0354 Â±0.006 0 2  0.033  Â±0.005 0 2  0.032  Â±0.005 0 2
10  2           1  |  0.329  Â±0.01  0 2  0.3304 Â±0.008 0 2  0.3384 Â±0.008 0 2
10  2           4  |  0.2936 Â±0.008 0 2  0.3186 Â±0.009 0 2  0.334  Â±0.01  0 2
10  2          10  |  0.2328 Â±0.006 0 2  0.2811 Â±0.003 0 2  0.326  Â±0.01  0 2
10  2          40  |  0.216  Â±0.01  0 2  0.268  Â±0.008 0 2  0.328  Â±0.01  0 2
"""
_print(xps, "rmse.a", dict(outer="da_method",inner="N",mean="seed",))

##
old = """Averages (in time and) over seed.

[43mTable for da_method='Climatology'[0m
 F  â‘Š   rmse.a Â±1Ïƒ     *('infl',)
--  -  --------------------------
 8  |  0.7775  Â±0.0005 *(None,)  
10  |  0.97285 Â±0.0005 *(None,)  

[43mTable for da_method='OptInterp'[0m
 F  â‘Š  rmse.a Â±1Ïƒ   *('infl',)
--  -  -----------------------
 8  |   0.145 Â±0.05 *(None,)  
10  |   0.145 Â±0.05 *(None,)  

[43mTable for da_method='Var3D'[0m
 F   xB  â‘Š  rmse.a Â±1Ïƒ    *('infl',)
--  ---  -  ------------------------
 8  0.1  |  0.1752 Â±0.004 *(None,)  
 8  0.2  |  0.2742 Â±0.006 *(None,)  
 8  0.4  |  0.3918 Â±0.006 *(None,)  
10  0.1  |  0.1824 Â±0.006 *(None,)  
10  0.2  |  0.2816 Â±0.008 *(None,)  
10  0.4  |  0.3976 Â±0.007 *(None,)  

[43mTable for da_method='EnKF'[0m
                __________N=10__________  ___________20___________  ___________50___________
 F  upd_a    â‘Š  rmse.a Â±1Ïƒ    *('infl',)  rmse.a Â±1Ïƒ    *('infl',)  rmse.a Â±1Ïƒ    *('infl',)
--  -------  -  ------------------------  ------------------------  ------------------------
 8  PertObs  |  0.0325 Â±0.005 *(1.01,)    0.031  Â±0.005 *(1.01,)     0.03  Â±0.005 *(1.1,)   
10  PertObs  |  0.034  Â±0.005 *(1.01,)    0.0325 Â±0.005 *(1.01,)     0.032 Â±0.005 *(1.1,)   
 8  Sqrt     |  0.0325 Â±0.005 *(1.01,)    0.031  Â±0.005 *(1.01,)     0.03  Â±0.005 *(1.1,)   
10  Sqrt     |  0.0345 Â±0.005 *(1.01,)    0.0325 Â±0.005 *(1.01,)     0.032 Â±0.005 *(1.1,)   

[43mTable for da_method='EnKF_N'[0m
       __________N=10__________  ___________20___________  ___________50___________
 F  â‘Š  rmse.a Â±1Ïƒ    *('infl',)  rmse.a Â±1Ïƒ    *('infl',)  rmse.a Â±1Ïƒ    *('infl',)
--  -  ------------------------  ------------------------  ------------------------
 8  |  0.0325 Â±0.005 *(1.0,)      0.031 Â±0.005 *(1.0,)      0.03  Â±0.005 *(1.0,)   
10  |  0.0345 Â±0.005 *(1.0,)      0.033 Â±0.005 *(1.0,)      0.032 Â±0.005 *(1.0,)   

[43mTable for da_method='LETKF'[0m
                __________N=10__________  ___________20___________  ___________50___________
 F  loc_rad  â‘Š  rmse.a Â±1Ïƒ    *('infl',)  rmse.a Â±1Ïƒ    *('infl',)  rmse.a Â±1Ïƒ    *('infl',)
--  -------  -  ------------------------  ------------------------  ------------------------
 8        1  |  0.032  Â±0.005 *(1.1,)     0.031  Â±0.005 *(1.1,)     0.03   Â±0.005 *(1.1,)   
 8        4  |  0.032  Â±0.005 *(1.01,)    0.031  Â±0.005 *(1.1,)     0.03   Â±0.005 *(1.1,)   
 8       10  |  0.032  Â±0.005 *(1.01,)    0.0305 Â±0.005 *(1.1,)     0.03   Â±0.005 *(1.1,)   
 8       40  |  0.0325 Â±0.005 *(1.01,)    0.031  Â±0.005 *(1.01,)    0.03   Â±0.005 *(1.1,)   
10        1  |  0.034  Â±0.005 *(1.1,)     0.0325 Â±0.005 *(1.1,)     0.0315 Â±0.005 *(1.1,)   
10        4  |  0.034  Â±0.005 *(1.01,)    0.0325 Â±0.005 *(1.1,)     0.0315 Â±0.005 *(1.1,)   
10       10  |  0.034  Â±0.005 *(1.01,)    0.0325 Â±0.005 *(1.1,)     0.0315 Â±0.005 *(1.1,)   
10       40  |  0.034  Â±0.005 *(1.01,)    0.0325 Â±0.005 *(1.01,)    0.032  Â±0.005 *(1.1,)   
"""
_print(xps, "rmse.a", dict(outer="da_method",inner="N",mean="seed",optim="infl"))

##
old = """Averages (in time and) over seed.

[43mTable for da_method='Climatology'[0m
 F  â‘Š  kurt.f Â±1Ïƒ  â˜  âœ“
--  -  ---------------
 8  |  nan    Â±nan 2 0
10  |  nan    Â±nan 2 0

[43mTable for da_method='OptInterp'[0m
 F  â‘Š  kurt.f Â±1Ïƒ  â˜  âœ“
--  -  ---------------
 8  |  nan    Â±nan 2 0
10  |  nan    Â±nan 2 0

[43mTable for da_method='Var3D'[0m
 F   xB  â‘Š  kurt.f Â±1Ïƒ  â˜  âœ“
--  ---  -  ---------------
 8  0.1  |  nan    Â±nan 2 0
 8  0.2  |  nan    Â±nan 2 0
 8  0.4  |  nan    Â±nan 2 0
10  0.1  |  nan    Â±nan 2 0
10  0.2  |  nan    Â±nan 2 0
10  0.4  |  nan    Â±nan 2 0

[43mTable for da_method='EnKF'[0m
                      ________N=10________  _________20_________  ________50________
 F  upd_a    infl  â‘Š    kurt.f Â±1Ïƒ     â˜  âœ“    kurt.f Â±1Ïƒ     â˜  âœ“   kurt.f Â±1Ïƒ    â˜  âœ“
--  -------  ----  -  --------------------  --------------------  ------------------
 8  PertObs  1.01  |  -1.04755 Â±0.0007 0 2  -0.627   Â±0.01   0 2  -0.21   Â±0.05  0 2
 8  PertObs  1.1   |  -1.044   Â±0.006  0 2  -0.6246  Â±0.009  0 2  -0.21   Â±0.05  0 2
 8  PertObs  2     |  -1.0448  Â±0.002  0 2  -0.63    Â±0.007  0 2  -0.248  Â±0.008 0 2
10  PertObs  1.01  |  -1.04279 Â±0.0007 0 2  -0.618   Â±0.01   0 2  -0.195  Â±0.05  0 2
10  PertObs  1.1   |  -1.0395  Â±0.005  0 2  -0.617   Â±0.01   0 2  -0.195  Â±0.05  0 2
10  PertObs  2     |  -1.053   Â±0.01   0 2  -0.61    Â±0.01   0 2  -0.245  Â±0.01  0 2
 8  Sqrt     1.01  |  -1.052   Â±0.02   0 2  -0.64148 Â±0.0004 0 2  -0.204  Â±0.02  0 2
 8  Sqrt     1.1   |  -1.054   Â±0.02   0 2  -0.64118 Â±0.0002 0 2  -0.206  Â±0.02  0 2
 8  Sqrt     2     |  -1.068   Â±0.03   0 2  -0.642   Â±0.02   0 2  -0.2085 Â±0.005 0 2
10  Sqrt     1.01  |  -1.052   Â±0.02   0 2  -0.6337  Â±0.001  0 2  -0.189  Â±0.03  0 2
10  Sqrt     1.1   |  -1.052   Â±0.02   0 2  -0.6339  Â±0.001  0 2  -0.19   Â±0.02  0 2
10  Sqrt     2     |  -1.072   Â±0.02   0 2  -0.6453  Â±0.009  0 2  -0.2075 Â±0.005 0 2

[43mTable for da_method='EnKF_N'[0m
       ______N=10______  _________20_________  _______50_______
 F  â‘Š  kurt.f Â±1Ïƒ   â˜  âœ“    kurt.f Â±1Ïƒ     â˜  âœ“  kurt.f Â±1Ïƒ   â˜  âœ“
--  -  ----------------  --------------------  ----------------
 8  |  -1.052 Â±0.02 0 2  -0.64155 Â±0.0005 0 2  -0.204 Â±0.02 0 2
10  |  -1.052 Â±0.02 0 2  -0.6337  Â±0.001  0 2  -0.189 Â±0.03 0 2

[43mTable for da_method='LETKF'[0m
                      ______N=10______  _________20_________  ________50________
 F  infl  loc_rad  â‘Š  kurt.f Â±1Ïƒ   â˜  âœ“    kurt.f Â±1Ïƒ     â˜  âœ“   kurt.f Â±1Ïƒ    â˜  âœ“
--  ----  -------  -  ----------------  --------------------  ------------------
 8  1.01        1  |  -1.052 Â±0.02 0 2  -0.64119 Â±0.0003 0 2  -0.204  Â±0.02  0 2
 8  1.01        4  |  -1.052 Â±0.02 0 2  -0.64113 Â±0.0003 0 2  -0.204  Â±0.02  0 2
 8  1.01       10  |  -1.052 Â±0.02 0 2  -0.64124 Â±0.0004 0 2  -0.204  Â±0.02  0 2
 8  1.01       40  |  -1.052 Â±0.02 0 2  -0.64148 Â±0.0004 0 2  -0.204  Â±0.02  0 2
 8  1.1         1  |  -1.052 Â±0.02 0 2  -0.64058 Â±0.0001 0 2  -0.206  Â±0.02  0 2
 8  1.1         4  |  -1.052 Â±0.02 0 2  -0.64047 Â±0.0001 0 2  -0.206  Â±0.02  0 2
 8  1.1        10  |  -1.052 Â±0.02 0 2  -0.64072 Â±0.0001 0 2  -0.206  Â±0.02  0 2
 8  1.1        40  |  -1.054 Â±0.02 0 2  -0.64114 Â±0.0002 0 2  -0.206  Â±0.02  0 2
 8  2           1  |  -1.045 Â±0.05 0 2  -0.618   Â±0.03   0 2  -0.217  Â±0.01  0 2
 8  2           4  |  -1.05  Â±0.06 0 2  -0.616   Â±0.04   0 2  -0.2112 Â±0.004 0 2
 8  2          10  |  -1.068 Â±0.04 0 2  -0.632   Â±0.02   0 2  -0.2095 Â±0.005 0 2
 8  2          40  |  -1.068 Â±0.03 0 2  -0.642   Â±0.02   0 2  -0.2085 Â±0.005 0 2
10  1.01        1  |  -1.052 Â±0.02 0 2  -0.6334  Â±0.002  0 2  -0.189  Â±0.03  0 2
10  1.01        4  |  -1.052 Â±0.02 0 2  -0.6332  Â±0.002  0 2  -0.189  Â±0.03  0 2
10  1.01       10  |  -1.052 Â±0.02 0 2  -0.6334  Â±0.001  0 2  -0.189  Â±0.03  0 2
10  1.01       40  |  -1.052 Â±0.02 0 2  -0.6337  Â±0.001  0 2  -0.189  Â±0.03  0 2
10  1.1         1  |  -1.05  Â±0.02 0 2  -0.633   Â±0.002  0 2  -0.189  Â±0.03  0 2
10  1.1         4  |  -1.05  Â±0.02 0 2  -0.633   Â±0.002  0 2  -0.19   Â±0.02  0 2
10  1.1        10  |  -1.052 Â±0.02 0 2  -0.6334  Â±0.002  0 2  -0.19   Â±0.02  0 2
10  1.1        40  |  -1.052 Â±0.02 0 2  -0.6338  Â±0.001  0 2  -0.19   Â±0.02  0 2
10  2           1  |  -1.044 Â±0.03 0 2  -0.61    Â±0.02   0 2  -0.206  Â±0.02  0 2
10  2           4  |  -1.044 Â±0.04 0 2  -0.614   Â±0.02   0 2  -0.21   Â±0.006 0 2
10  2          10  |  -1.068 Â±0.03 0 2  -0.6315  Â±0.003  0 2  -0.2092 Â±0.004 0 2
10  2          40  |  -1.072 Â±0.02 0 2  -0.6444  Â±0.009  0 2  -0.2076 Â±0.004 0 2
"""
_print(xps, "kurt.f", dict(outer="da_method",inner="N",mean="seed",))

##
old = """Averages (in time and) over seed.

[43mTable for da_method='Climatology'[0m
 F  â‘Š   rmse.a Â±1Ïƒ     â˜  âœ“
--  -  -------------------
 8  |  0.7775  Â±0.0005 0 2
10  |  0.97285 Â±0.0005 0 2

[43mTable for da_method='OptInterp'[0m
 F  â‘Š  rmse.a Â±1Ïƒ   â˜  âœ“
--  -  ----------------
 8  |   0.145 Â±0.05 0 2
10  |   0.145 Â±0.05 0 2

[43mTable for da_method='Var3D'[0m
 F   xB  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“
--  ---  -  -----------------
 8  0.1  |  0.1752 Â±0.004 0 2
 8  0.2  |  0.2742 Â±0.006 0 2
 8  0.4  |  0.3918 Â±0.006 0 2
10  0.1  |  0.1824 Â±0.006 0 2
10  0.2  |  0.2816 Â±0.008 0 2
10  0.4  |  0.3976 Â±0.007 0 2

[43mTable for da_method='EnKF'[0m
                    ____infl=1.01____  _______1.1_______  ________2.0________
 F  upd_a     N  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“   rmse.a Â±1Ïƒ     â˜  âœ“
--  -------  --  -  -----------------  -----------------  -------------------
 8  PertObs  10  |  0.0325 Â±0.005 0 2  0.0335 Â±0.005 0 2  0.18836 Â±0.0002 0 2
 8  PertObs  20  |  0.031  Â±0.005 0 2  0.031  Â±0.005 0 2  0.232   Â±0.02   0 2
 8  PertObs  50  |  0.03   Â±0.005 0 2  0.03   Â±0.005 0 2  0.294   Â±0.02   0 2
10  PertObs  10  |  0.034  Â±0.005 0 2  0.036  Â±0.005 0 2  0.1892  Â±0.004  0 2
10  PertObs  20  |  0.0325 Â±0.005 0 2  0.033  Â±0.006 0 2  0.236   Â±0.02   0 2
10  PertObs  50  |  0.032  Â±0.005 0 2  0.032  Â±0.005 0 2  0.302   Â±0.02   0 2
 8  Sqrt     10  |  0.0325 Â±0.005 0 2  0.0335 Â±0.005 0 2  0.214   Â±0.01   0 2
 8  Sqrt     20  |  0.031  Â±0.005 0 2  0.031  Â±0.005 0 2  0.2646  Â±0.007  0 2
 8  Sqrt     50  |  0.03   Â±0.005 0 2  0.03   Â±0.005 0 2  0.323   Â±0.01   0 2
10  Sqrt     10  |  0.0345 Â±0.005 0 2  0.0354 Â±0.006 0 2  0.217   Â±0.01   0 2
10  Sqrt     20  |  0.0325 Â±0.005 0 2  0.033  Â±0.005 0 2  0.268   Â±0.008  0 2
10  Sqrt     50  |  0.032  Â±0.005 0 2  0.032  Â±0.005 0 2  0.329   Â±0.01   0 2

[43mTable for da_method='EnKF_N'[0m
 F   N  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“
--  --  -  -----------------
 8  10  |  0.0325 Â±0.005 0 2
 8  20  |  0.031  Â±0.005 0 2
 8  50  |  0.03   Â±0.005 0 2
10  10  |  0.0345 Â±0.005 0 2
10  20  |  0.033  Â±0.005 0 2
10  50  |  0.032  Â±0.005 0 2

[43mTable for da_method='LETKF'[0m
                    ____infl=1.01____  _______1.1_______  _______2.0_______
 F   N  loc_rad  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
--  --  -------  -  -----------------  -----------------  -----------------
 8  10        1  |  0.0325 Â±0.005 0 2  0.032  Â±0.005 0 2  0.323  Â±0.01  0 2
 8  10        4  |  0.032  Â±0.005 0 2  0.0325 Â±0.005 0 2  0.2886 Â±0.006 0 2
 8  10       10  |  0.032  Â±0.005 0 2  0.0325 Â±0.005 0 2  0.2282 Â±0.007 0 2
 8  10       40  |  0.0325 Â±0.005 0 2  0.033  Â±0.005 0 2  0.213  Â±0.01  0 2
 8  20        1  |  0.031  Â±0.005 0 2  0.031  Â±0.005 0 2  0.325  Â±0.01  0 2
 8  20        4  |  0.031  Â±0.005 0 2  0.031  Â±0.005 0 2  0.313  Â±0.01  0 2
 8  20       10  |  0.031  Â±0.005 0 2  0.0305 Â±0.005 0 2  0.2751 Â±0.001 0 2
 8  20       40  |  0.031  Â±0.005 0 2  0.031  Â±0.005 0 2  0.2639 Â±0.007 0 2
 8  50        1  |  0.03   Â±0.005 0 2  0.03   Â±0.005 0 2  0.333  Â±0.009 0 2
 8  50        4  |  0.03   Â±0.005 0 2  0.03   Â±0.005 0 2  0.33   Â±0.01  0 2
 8  50       10  |  0.03   Â±0.005 0 2  0.03   Â±0.005 0 2  0.321  Â±0.01  0 2
 8  50       40  |  0.03   Â±0.005 0 2  0.03   Â±0.005 0 2  0.323  Â±0.01  0 2
10  10        1  |  0.034  Â±0.005 0 2  0.034  Â±0.005 0 2  0.329  Â±0.01  0 2
10  10        4  |  0.034  Â±0.005 0 2  0.0345 Â±0.005 0 2  0.2936 Â±0.008 0 2
10  10       10  |  0.034  Â±0.005 0 2  0.0345 Â±0.005 0 2  0.2328 Â±0.006 0 2
10  10       40  |  0.034  Â±0.005 0 2  0.0354 Â±0.006 0 2  0.216  Â±0.01  0 2
10  20        1  |  0.033  Â±0.005 0 2  0.0325 Â±0.005 0 2  0.3304 Â±0.008 0 2
10  20        4  |  0.0325 Â±0.005 0 2  0.0325 Â±0.005 0 2  0.3186 Â±0.009 0 2
10  20       10  |  0.0325 Â±0.005 0 2  0.0325 Â±0.005 0 2  0.2811 Â±0.003 0 2
10  20       40  |  0.0325 Â±0.005 0 2  0.033  Â±0.005 0 2  0.268  Â±0.008 0 2
10  50        1  |  0.032  Â±0.005 0 2  0.0315 Â±0.005 0 2  0.3384 Â±0.008 0 2
10  50        4  |  0.0315 Â±0.005 0 2  0.0315 Â±0.005 0 2  0.334  Â±0.01  0 2
10  50       10  |  0.0315 Â±0.005 0 2  0.0315 Â±0.005 0 2  0.326  Â±0.01  0 2
10  50       40  |  0.032  Â±0.005 0 2  0.032  Â±0.005 0 2  0.328  Â±0.01  0 2
"""
_print(xps, "rmse.a", dict(outer="da_method",inner="infl",mean="seed",))

##
old = """Averages (in time and) over seed.

[43mTable for N=None[0m
da_method     F   xB  â‘Š   rmse.a Â±1Ïƒ     â˜  âœ“
-----------  --  ---  -  -------------------
Climatology   8       |  0.7775  Â±0.0005 0 2
Climatology  10       |  0.97285 Â±0.0005 0 2
OptInterp     8       |  0.145   Â±0.05   0 2
OptInterp    10       |  0.145   Â±0.05   0 2
Var3D         8  0.1  |  0.1752  Â±0.004  0 2
Var3D         8  0.2  |  0.2742  Â±0.006  0 2
Var3D         8  0.4  |  0.3918  Â±0.006  0 2
Var3D        10  0.1  |  0.1824  Â±0.006  0 2
Var3D        10  0.2  |  0.2816  Â±0.008  0 2
Var3D        10  0.4  |  0.3976  Â±0.007  0 2

[43mTable for N=10[0m
                                    ____infl=1.01____  _______1.1_______  ________2.0________  _______1.0_______
da_method   F  upd_a    loc_rad  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“   rmse.a Â±1Ïƒ     â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
---------  --  -------  -------  -  -----------------  -----------------  -------------------  -----------------
EnKF        8  PertObs           |  0.0325 Â±0.005 0 2  0.0335 Â±0.005 0 2  0.18836 Â±0.0002 0 2         Â±         
EnKF       10  PertObs           |  0.034  Â±0.005 0 2  0.036  Â±0.005 0 2  0.1892  Â±0.004  0 2         Â±         
EnKF        8  Sqrt              |  0.0325 Â±0.005 0 2  0.0335 Â±0.005 0 2  0.214   Â±0.01   0 2         Â±         
EnKF       10  Sqrt              |  0.0345 Â±0.005 0 2  0.0354 Â±0.006 0 2  0.217   Â±0.01   0 2         Â±         
EnKF_N      8                    |         Â±                  Â±                   Â±            0.0325 Â±0.005 0 2
EnKF_N     10                    |         Â±                  Â±                   Â±            0.0345 Â±0.005 0 2
LETKF       8                 1  |  0.0325 Â±0.005 0 2  0.032  Â±0.005 0 2  0.323   Â±0.01   0 2         Â±         
LETKF       8                 4  |  0.032  Â±0.005 0 2  0.0325 Â±0.005 0 2  0.2886  Â±0.006  0 2         Â±         
LETKF       8                10  |  0.032  Â±0.005 0 2  0.0325 Â±0.005 0 2  0.2282  Â±0.007  0 2         Â±         
LETKF       8                40  |  0.0325 Â±0.005 0 2  0.033  Â±0.005 0 2  0.213   Â±0.01   0 2         Â±         
LETKF      10                 1  |  0.034  Â±0.005 0 2  0.034  Â±0.005 0 2  0.329   Â±0.01   0 2         Â±         
LETKF      10                 4  |  0.034  Â±0.005 0 2  0.0345 Â±0.005 0 2  0.2936  Â±0.008  0 2         Â±         
LETKF      10                10  |  0.034  Â±0.005 0 2  0.0345 Â±0.005 0 2  0.2328  Â±0.006  0 2         Â±         
LETKF      10                40  |  0.034  Â±0.005 0 2  0.0354 Â±0.006 0 2  0.216   Â±0.01   0 2         Â±         

[43mTable for N=20[0m
                                    ____infl=1.01____  _______1.1_______  _______2.0_______  _______1.0_______
da_method   F  upd_a    loc_rad  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
---------  --  -------  -------  -  -----------------  -----------------  -----------------  -----------------
EnKF        8  PertObs           |  0.031  Â±0.005 0 2  0.031  Â±0.005 0 2  0.232  Â±0.02  0 2         Â±         
EnKF       10  PertObs           |  0.0325 Â±0.005 0 2  0.033  Â±0.006 0 2  0.236  Â±0.02  0 2         Â±         
EnKF        8  Sqrt              |  0.031  Â±0.005 0 2  0.031  Â±0.005 0 2  0.2646 Â±0.007 0 2         Â±         
EnKF       10  Sqrt              |  0.0325 Â±0.005 0 2  0.033  Â±0.005 0 2  0.268  Â±0.008 0 2         Â±         
EnKF_N      8                    |         Â±                  Â±                  Â±           0.031  Â±0.005 0 2
EnKF_N     10                    |         Â±                  Â±                  Â±           0.033  Â±0.005 0 2
LETKF       8                 1  |  0.031  Â±0.005 0 2  0.031  Â±0.005 0 2  0.325  Â±0.01  0 2         Â±         
LETKF       8                 4  |  0.031  Â±0.005 0 2  0.031  Â±0.005 0 2  0.313  Â±0.01  0 2         Â±         
LETKF       8                10  |  0.031  Â±0.005 0 2  0.0305 Â±0.005 0 2  0.2751 Â±0.001 0 2         Â±         
LETKF       8                40  |  0.031  Â±0.005 0 2  0.031  Â±0.005 0 2  0.2639 Â±0.007 0 2         Â±         
LETKF      10                 1  |  0.033  Â±0.005 0 2  0.0325 Â±0.005 0 2  0.3304 Â±0.008 0 2         Â±         
LETKF      10                 4  |  0.0325 Â±0.005 0 2  0.0325 Â±0.005 0 2  0.3186 Â±0.009 0 2         Â±         
LETKF      10                10  |  0.0325 Â±0.005 0 2  0.0325 Â±0.005 0 2  0.2811 Â±0.003 0 2         Â±         
LETKF      10                40  |  0.0325 Â±0.005 0 2  0.033  Â±0.005 0 2  0.268  Â±0.008 0 2         Â±         

[43mTable for N=50[0m
                                    ____infl=1.01____  _______1.1_______  _______2.0_______  _______1.0_______
da_method   F  upd_a    loc_rad  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
---------  --  -------  -------  -  -----------------  -----------------  -----------------  -----------------
EnKF        8  PertObs           |  0.03   Â±0.005 0 2  0.03   Â±0.005 0 2  0.294  Â±0.02  0 2         Â±         
EnKF       10  PertObs           |  0.032  Â±0.005 0 2  0.032  Â±0.005 0 2  0.302  Â±0.02  0 2         Â±         
EnKF        8  Sqrt              |  0.03   Â±0.005 0 2  0.03   Â±0.005 0 2  0.323  Â±0.01  0 2         Â±         
EnKF       10  Sqrt              |  0.032  Â±0.005 0 2  0.032  Â±0.005 0 2  0.329  Â±0.01  0 2         Â±         
EnKF_N      8                    |         Â±                  Â±                  Â±           0.03   Â±0.005 0 2
EnKF_N     10                    |         Â±                  Â±                  Â±           0.032  Â±0.005 0 2
LETKF       8                 1  |  0.03   Â±0.005 0 2  0.03   Â±0.005 0 2  0.333  Â±0.009 0 2         Â±         
LETKF       8                 4  |  0.03   Â±0.005 0 2  0.03   Â±0.005 0 2  0.33   Â±0.01  0 2         Â±         
LETKF       8                10  |  0.03   Â±0.005 0 2  0.03   Â±0.005 0 2  0.321  Â±0.01  0 2         Â±         
LETKF       8                40  |  0.03   Â±0.005 0 2  0.03   Â±0.005 0 2  0.323  Â±0.01  0 2         Â±         
LETKF      10                 1  |  0.032  Â±0.005 0 2  0.0315 Â±0.005 0 2  0.3384 Â±0.008 0 2         Â±         
LETKF      10                 4  |  0.0315 Â±0.005 0 2  0.0315 Â±0.005 0 2  0.334  Â±0.01  0 2         Â±         
LETKF      10                10  |  0.0315 Â±0.005 0 2  0.0315 Â±0.005 0 2  0.326  Â±0.01  0 2         Â±         
LETKF      10                40  |  0.032  Â±0.005 0 2  0.032  Â±0.005 0 2  0.328  Â±0.01  0 2         Â±         
"""
_print(xps, "rmse.a", dict(outer="N",inner="infl",mean="seed",))

##
old = """Averages (in time and) over seed.

[43mTable for N=None[0m
            da_method='Climatology'  ___OptInterp____  ______Var3D______
 F   xB  â‘Š   rmse.a Â±1Ïƒ     â˜  âœ“      rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
--  ---  -  -----------------------  ----------------  -----------------
 8       |  0.7775  Â±0.0005 0 2      0.145  Â±0.05 0 2         Â±         
10       |  0.97285 Â±0.0005 0 2      0.145  Â±0.05 0 2         Â±         
 8  0.1  |          Â±                       Â±          0.1752 Â±0.004 0 2
 8  0.2  |          Â±                       Â±          0.2742 Â±0.006 0 2
 8  0.4  |          Â±                       Â±          0.3918 Â±0.006 0 2
10  0.1  |          Â±                       Â±          0.1824 Â±0.006 0 2
10  0.2  |          Â±                       Â±          0.2816 Â±0.008 0 2
10  0.4  |          Â±                       Â±          0.3976 Â±0.007 0 2

[43mTable for N=10[0m
                               __da_method='EnKF'_  ______EnKF_N_____  ______LETKF______
 F  upd_a    infl  loc_rad  â‘Š   rmse.a Â±1Ïƒ     â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
--  -------  ----  -------  -  -------------------  -----------------  -----------------
 8  PertObs  1.01           |  0.0325  Â±0.005  0 2         Â±                  Â±         
 8  PertObs  1.1            |  0.0335  Â±0.005  0 2         Â±                  Â±         
 8  PertObs  2              |  0.18836 Â±0.0002 0 2         Â±                  Â±         
10  PertObs  1.01           |  0.034   Â±0.005  0 2         Â±                  Â±         
10  PertObs  1.1            |  0.036   Â±0.005  0 2         Â±                  Â±         
10  PertObs  2              |  0.1892  Â±0.004  0 2         Â±                  Â±         
 8  Sqrt     1.01           |  0.0325  Â±0.005  0 2         Â±                  Â±         
 8  Sqrt     1.1            |  0.0335  Â±0.005  0 2         Â±                  Â±         
 8  Sqrt     2              |  0.214   Â±0.01   0 2         Â±                  Â±         
10  Sqrt     1.01           |  0.0345  Â±0.005  0 2         Â±                  Â±         
10  Sqrt     1.1            |  0.0354  Â±0.006  0 2         Â±                  Â±         
10  Sqrt     2              |  0.217   Â±0.01   0 2         Â±                  Â±         
 8           1              |          Â±            0.0325 Â±0.005 0 2         Â±         
10           1              |          Â±            0.0345 Â±0.005 0 2         Â±         
 8           1.01        1  |          Â±                   Â±           0.0325 Â±0.005 0 2
 8           1.01        4  |          Â±                   Â±           0.032  Â±0.005 0 2
 8           1.01       10  |          Â±                   Â±           0.032  Â±0.005 0 2
 8           1.01       40  |          Â±                   Â±           0.0325 Â±0.005 0 2
 8           1.1         1  |          Â±                   Â±           0.032  Â±0.005 0 2
 8           1.1         4  |          Â±                   Â±           0.0325 Â±0.005 0 2
 8           1.1        10  |          Â±                   Â±           0.0325 Â±0.005 0 2
 8           1.1        40  |          Â±                   Â±           0.033  Â±0.005 0 2
 8           2           1  |          Â±                   Â±           0.323  Â±0.01  0 2
 8           2           4  |          Â±                   Â±           0.2886 Â±0.006 0 2
 8           2          10  |          Â±                   Â±           0.2282 Â±0.007 0 2
 8           2          40  |          Â±                   Â±           0.213  Â±0.01  0 2
10           1.01        1  |          Â±                   Â±           0.034  Â±0.005 0 2
10           1.01        4  |          Â±                   Â±           0.034  Â±0.005 0 2
10           1.01       10  |          Â±                   Â±           0.034  Â±0.005 0 2
10           1.01       40  |          Â±                   Â±           0.034  Â±0.005 0 2
10           1.1         1  |          Â±                   Â±           0.034  Â±0.005 0 2
10           1.1         4  |          Â±                   Â±           0.0345 Â±0.005 0 2
10           1.1        10  |          Â±                   Â±           0.0345 Â±0.005 0 2
10           1.1        40  |          Â±                   Â±           0.0354 Â±0.006 0 2
10           2           1  |          Â±                   Â±           0.329  Â±0.01  0 2
10           2           4  |          Â±                   Â±           0.2936 Â±0.008 0 2
10           2          10  |          Â±                   Â±           0.2328 Â±0.006 0 2
10           2          40  |          Â±                   Â±           0.216  Â±0.01  0 2

[43mTable for N=20[0m
                               _da_method='EnKF'  ______EnKF_N_____  ______LETKF______
 F  upd_a    infl  loc_rad  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
--  -------  ----  -------  -  -----------------  -----------------  -----------------
 8  PertObs  1.01           |  0.031  Â±0.005 0 2         Â±                  Â±         
 8  PertObs  1.1            |  0.031  Â±0.005 0 2         Â±                  Â±         
 8  PertObs  2              |  0.232  Â±0.02  0 2         Â±                  Â±         
10  PertObs  1.01           |  0.0325 Â±0.005 0 2         Â±                  Â±         
10  PertObs  1.1            |  0.033  Â±0.006 0 2         Â±                  Â±         
10  PertObs  2              |  0.236  Â±0.02  0 2         Â±                  Â±         
 8  Sqrt     1.01           |  0.031  Â±0.005 0 2         Â±                  Â±         
 8  Sqrt     1.1            |  0.031  Â±0.005 0 2         Â±                  Â±         
 8  Sqrt     2              |  0.2646 Â±0.007 0 2         Â±                  Â±         
10  Sqrt     1.01           |  0.0325 Â±0.005 0 2         Â±                  Â±         
10  Sqrt     1.1            |  0.033  Â±0.005 0 2         Â±                  Â±         
10  Sqrt     2              |  0.268  Â±0.008 0 2         Â±                  Â±         
 8           1              |         Â±           0.031  Â±0.005 0 2         Â±         
10           1              |         Â±           0.033  Â±0.005 0 2         Â±         
 8           1.01        1  |         Â±                  Â±           0.031  Â±0.005 0 2
 8           1.01        4  |         Â±                  Â±           0.031  Â±0.005 0 2
 8           1.01       10  |         Â±                  Â±           0.031  Â±0.005 0 2
 8           1.01       40  |         Â±                  Â±           0.031  Â±0.005 0 2
 8           1.1         1  |         Â±                  Â±           0.031  Â±0.005 0 2
 8           1.1         4  |         Â±                  Â±           0.031  Â±0.005 0 2
 8           1.1        10  |         Â±                  Â±           0.0305 Â±0.005 0 2
 8           1.1        40  |         Â±                  Â±           0.031  Â±0.005 0 2
 8           2           1  |         Â±                  Â±           0.325  Â±0.01  0 2
 8           2           4  |         Â±                  Â±           0.313  Â±0.01  0 2
 8           2          10  |         Â±                  Â±           0.2751 Â±0.001 0 2
 8           2          40  |         Â±                  Â±           0.2639 Â±0.007 0 2
10           1.01        1  |         Â±                  Â±           0.033  Â±0.005 0 2
10           1.01        4  |         Â±                  Â±           0.0325 Â±0.005 0 2
10           1.01       10  |         Â±                  Â±           0.0325 Â±0.005 0 2
10           1.01       40  |         Â±                  Â±           0.0325 Â±0.005 0 2
10           1.1         1  |         Â±                  Â±           0.0325 Â±0.005 0 2
10           1.1         4  |         Â±                  Â±           0.0325 Â±0.005 0 2
10           1.1        10  |         Â±                  Â±           0.0325 Â±0.005 0 2
10           1.1        40  |         Â±                  Â±           0.033  Â±0.005 0 2
10           2           1  |         Â±                  Â±           0.3304 Â±0.008 0 2
10           2           4  |         Â±                  Â±           0.3186 Â±0.009 0 2
10           2          10  |         Â±                  Â±           0.2811 Â±0.003 0 2
10           2          40  |         Â±                  Â±           0.268  Â±0.008 0 2

[43mTable for N=50[0m
                               _da_method='EnKF'  ______EnKF_N_____  ______LETKF______
 F  upd_a    infl  loc_rad  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
--  -------  ----  -------  -  -----------------  -----------------  -----------------
 8  PertObs  1.01           |  0.03   Â±0.005 0 2         Â±                  Â±         
 8  PertObs  1.1            |  0.03   Â±0.005 0 2         Â±                  Â±         
 8  PertObs  2              |  0.294  Â±0.02  0 2         Â±                  Â±         
10  PertObs  1.01           |  0.032  Â±0.005 0 2         Â±                  Â±         
10  PertObs  1.1            |  0.032  Â±0.005 0 2         Â±                  Â±         
10  PertObs  2              |  0.302  Â±0.02  0 2         Â±                  Â±         
 8  Sqrt     1.01           |  0.03   Â±0.005 0 2         Â±                  Â±         
 8  Sqrt     1.1            |  0.03   Â±0.005 0 2         Â±                  Â±         
 8  Sqrt     2              |  0.323  Â±0.01  0 2         Â±                  Â±         
10  Sqrt     1.01           |  0.032  Â±0.005 0 2         Â±                  Â±         
10  Sqrt     1.1            |  0.032  Â±0.005 0 2         Â±                  Â±         
10  Sqrt     2              |  0.329  Â±0.01  0 2         Â±                  Â±         
 8           1              |         Â±           0.03   Â±0.005 0 2         Â±         
10           1              |         Â±           0.032  Â±0.005 0 2         Â±         
 8           1.01        1  |         Â±                  Â±           0.03   Â±0.005 0 2
 8           1.01        4  |         Â±                  Â±           0.03   Â±0.005 0 2
 8           1.01       10  |         Â±                  Â±           0.03   Â±0.005 0 2
 8           1.01       40  |         Â±                  Â±           0.03   Â±0.005 0 2
 8           1.1         1  |         Â±                  Â±           0.03   Â±0.005 0 2
 8           1.1         4  |         Â±                  Â±           0.03   Â±0.005 0 2
 8           1.1        10  |         Â±                  Â±           0.03   Â±0.005 0 2
 8           1.1        40  |         Â±                  Â±           0.03   Â±0.005 0 2
 8           2           1  |         Â±                  Â±           0.333  Â±0.009 0 2
 8           2           4  |         Â±                  Â±           0.33   Â±0.01  0 2
 8           2          10  |         Â±                  Â±           0.321  Â±0.01  0 2
 8           2          40  |         Â±                  Â±           0.323  Â±0.01  0 2
10           1.01        1  |         Â±                  Â±           0.032  Â±0.005 0 2
10           1.01        4  |         Â±                  Â±           0.0315 Â±0.005 0 2
10           1.01       10  |         Â±                  Â±           0.0315 Â±0.005 0 2
10           1.01       40  |         Â±                  Â±           0.032  Â±0.005 0 2
10           1.1         1  |         Â±                  Â±           0.0315 Â±0.005 0 2
10           1.1         4  |         Â±                  Â±           0.0315 Â±0.005 0 2
10           1.1        10  |         Â±                  Â±           0.0315 Â±0.005 0 2
10           1.1        40  |         Â±                  Â±           0.032  Â±0.005 0 2
10           2           1  |         Â±                  Â±           0.3384 Â±0.008 0 2
10           2           4  |         Â±                  Â±           0.334  Â±0.01  0 2
10           2          10  |         Â±                  Â±           0.326  Â±0.01  0 2
10           2          40  |         Â±                  Â±           0.328  Â±0.01  0 2
"""
_print(xps, "rmse.a", dict(outer="N",inner="da_method",mean="seed",))

##
old = """Averages in time only (=> the 1Ïƒ estimates may be unreliable).

[43mTable for N=None[0m
                         _seed=3000__  ____3001____
da_method     F   xB  â‘Š  rmse.a Â±1Ïƒ    rmse.a Â±1Ïƒ
-----------  --  ---  -  ------------  ------------
Climatology   8       |   0.78  Â±0.2    0.78  Â±0.2 
Climatology  10       |   0.96  Â±0.3    0.96  Â±0.3 
OptInterp     8       |   0.096 Â±0.03   0.192 Â±0.03
OptInterp    10       |   0.098 Â±0.02   0.195 Â±0.03
Var3D         8  0.1  |   0.18  Â±0.02   0.172 Â±0.02
Var3D         8  0.2  |   0.28  Â±0.02   0.268 Â±0.02
Var3D         8  0.4  |   0.398 Â±0.02   0.386 Â±0.01
Var3D        10  0.1  |   0.189 Â±0.03   0.176 Â±0.02
Var3D        10  0.2  |   0.291 Â±0.03   0.274 Â±0.02
Var3D        10  0.4  |   0.404 Â±0.02   0.39  Â±0.01

[43mTable for N=10[0m
                                          ___seed=3000___  ______3001_____
da_method   F  upd_a    infl  loc_rad  â‘Š   rmse.a Â±1Ïƒ       rmse.a Â±1Ïƒ
---------  --  -------  ----  -------  -  ---------------  ---------------
EnKF        8  PertObs  1.01           |  0.03708 Â±0.0009  0.0277  Â±0.001 
EnKF        8  PertObs  1.1            |  0.0384  Â±0.002   0.0285  Â±0.001 
EnKF        8  PertObs  2              |  0.192   Â±0.08    0.186   Â±0.06  
EnKF       10  PertObs  1.01           |  0.0394  Â±0.002   0.02907 Â±0.0009
EnKF       10  PertObs  1.1            |  0.0412  Â±0.004   0.0308  Â±0.002 
EnKF       10  PertObs  2              |  0.184   Â±0.08    0.196   Â±0.07  
EnKF        8  Sqrt     1.01           |  0.03717 Â±0.0009  0.0277  Â±0.001 
EnKF        8  Sqrt     1.1            |  0.0384  Â±0.002   0.0281  Â±0.001 
EnKF        8  Sqrt     2              |  0.23    Â±0.1     0.2     Â±0.08  
EnKF       10  Sqrt     1.01           |  0.0396  Â±0.002   0.02907 Â±0.0009
EnKF       10  Sqrt     1.1            |  0.0412  Â±0.004   0.03    Â±0.002 
EnKF       10  Sqrt     2              |  0.23    Â±0.1     0.208   Â±0.08  
EnKF_N      8           1              |  0.03717 Â±0.0009  0.0277  Â±0.001 
EnKF_N     10           1              |  0.0394  Â±0.002   0.02907 Â±0.0009
LETKF       8           1.01        1  |  0.0369  Â±0.0009  0.02772 Â±0.0009
LETKF       8           1.01        4  |  0.03688 Â±0.0008  0.0275  Â±0.001 
LETKF       8           1.01       10  |  0.0369  Â±0.0009  0.0275  Â±0.001 
LETKF       8           1.01       40  |  0.03717 Â±0.0009  0.0277  Â±0.001 
LETKF       8           1.1         1  |  0.03672 Â±0.0009  0.02772 Â±0.0009
LETKF       8           1.1         4  |  0.03708 Â±0.0009  0.02763 Â±0.0009
LETKF       8           1.1        10  |  0.0374  Â±0.001   0.0276  Â±0.001 
LETKF       8           1.1        40  |  0.0384  Â±0.002   0.0281  Â±0.001 
LETKF       8           2           1  |  0.32    Â±0.2     0.34    Â±0.2   
LETKF       8           2           4  |  0.28    Â±0.1     0.3     Â±0.1   
LETKF       8           2          10  |  0.24    Â±0.1     0.216   Â±0.09  
LETKF       8           2          40  |  0.23    Â±0.1     0.2     Â±0.08  
LETKF      10           1.01        1  |  0.0392  Â±0.002   0.02916 Â±0.0009
LETKF      10           1.01        4  |  0.0392  Â±0.002   0.02896 Â±0.0008
LETKF      10           1.01       10  |  0.0392  Â±0.002   0.02888 Â±0.0008
LETKF      10           1.01       40  |  0.0394  Â±0.002   0.02898 Â±0.0009
LETKF      10           1.1         1  |  0.039   Â±0.002   0.02916 Â±0.0009
LETKF      10           1.1         4  |  0.0396  Â±0.002   0.0292  Â±0.001 
LETKF      10           1.1        10  |  0.0399  Â±0.003   0.0294  Â±0.001 
LETKF      10           1.1        40  |  0.0412  Â±0.004   0.03    Â±0.002 
LETKF      10           2           1  |  0.32    Â±0.2     0.34    Â±0.2   
LETKF      10           2           4  |  0.29    Â±0.1     0.3     Â±0.1   
LETKF      10           2          10  |  0.24    Â±0.1     0.23    Â±0.1   
LETKF      10           2          40  |  0.23    Â±0.1     0.2     Â±0.08  

[43mTable for N=20[0m
                                          ___seed=3000___  ______3001_____
da_method   F  upd_a    infl  loc_rad  â‘Š   rmse.a Â±1Ïƒ       rmse.a Â±1Ïƒ
---------  --  -------  ----  -------  -  ---------------  ---------------
EnKF        8  PertObs  1.01           |  0.03591 Â±0.0009  0.026   Â±0.0008
EnKF        8  PertObs  1.1            |  0.0364  Â±0.001   0.0261  Â±0.0009
EnKF        8  PertObs  2              |  0.25    Â±0.1     0.207   Â±0.09  
EnKF       10  PertObs  1.01           |  0.038   Â±0.002   0.02745 Â±0.0009
EnKF       10  PertObs  1.1            |  0.0386  Â±0.002   0.0276  Â±0.001 
EnKF       10  PertObs  2              |  0.25    Â±0.1     0.216   Â±0.09  
EnKF        8  Sqrt     1.01           |  0.036   Â±0.0008  0.02608 Â±0.0008
EnKF        8  Sqrt     1.1            |  0.0363  Â±0.001   0.0261  Â±0.0009
EnKF        8  Sqrt     2              |  0.27    Â±0.1     0.26    Â±0.1   
EnKF       10  Sqrt     1.01           |  0.038   Â±0.002   0.02745 Â±0.0009
EnKF       10  Sqrt     1.1            |  0.0384  Â±0.002   0.0277  Â±0.001 
EnKF       10  Sqrt     2              |  0.28    Â±0.1     0.26    Â±0.1   
EnKF_N      8           1              |  0.036   Â±0.0008  0.02608 Â±0.0008
EnKF_N     10           1              |  0.038   Â±0.002   0.02745 Â±0.0009
LETKF       8           1.01        1  |  0.03592 Â±0.0008  0.02618 Â±0.0007
LETKF       8           1.01        4  |  0.03576 Â±0.0008  0.02604 Â±0.0007
LETKF       8           1.01       10  |  0.03564 Â±0.0009  0.026   Â±0.0008
LETKF       8           1.01       40  |  0.03592 Â±0.0008  0.026   Â±0.0008
LETKF       8           1.1         1  |  0.03576 Â±0.0008  0.02618 Â±0.0007
LETKF       8           1.1         4  |  0.0356  Â±0.0008  0.02592 Â±0.0008
LETKF       8           1.1        10  |  0.03555 Â±0.0009  0.02583 Â±0.0009
LETKF       8           1.1        40  |  0.03618 Â±0.0009  0.0261  Â±0.0009
LETKF       8           2           1  |  0.32    Â±0.2     0.34    Â±0.2   
LETKF       8           2           4  |  0.3     Â±0.1     0.32    Â±0.2   
LETKF       8           2          10  |  0.28    Â±0.1     0.27    Â±0.1   
LETKF       8           2          40  |  0.27    Â±0.1     0.26    Â±0.1   
LETKF      10           1.01        1  |  0.038   Â±0.002   0.0276  Â±0.001 
LETKF      10           1.01        4  |  0.0378  Â±0.001   0.02754 Â±0.0009
LETKF      10           1.01       10  |  0.0377  Â±0.001   0.02745 Â±0.0009
LETKF      10           1.01       40  |  0.038   Â±0.002   0.02745 Â±0.0009
LETKF      10           1.1         1  |  0.0378  Â±0.002   0.02763 Â±0.0009
LETKF      10           1.1         4  |  0.0376  Â±0.001   0.0274  Â±0.001 
LETKF      10           1.1        10  |  0.0375  Â±0.001   0.02736 Â±0.0008
LETKF      10           1.1        40  |  0.0382  Â±0.002   0.0276  Â±0.001 
LETKF      10           2           1  |  0.32    Â±0.2     0.34    Â±0.2   
LETKF      10           2           4  |  0.31    Â±0.1     0.32    Â±0.2   
LETKF      10           2          10  |  0.28    Â±0.1     0.28    Â±0.1   
LETKF      10           2          40  |  0.28    Â±0.1     0.26    Â±0.1   

[43mTable for N=50[0m
                                          ___seed=3000___  ______3001_____
da_method   F  upd_a    infl  loc_rad  â‘Š   rmse.a Â±1Ïƒ       rmse.a Â±1Ïƒ
---------  --  -------  ----  -------  -  ---------------  ---------------
EnKF        8  PertObs  1.01           |  0.03519 Â±0.0009  0.02528 Â±0.0008
EnKF        8  PertObs  1.1            |  0.03501 Â±0.0009  0.02536 Â±0.0008
EnKF        8  PertObs  2              |  0.27    Â±0.1     0.31    Â±0.1   
EnKF       10  PertObs  1.01           |  0.0372  Â±0.001   0.02664 Â±0.0008
EnKF       10  PertObs  1.1            |  0.0369  Â±0.001   0.0269  Â±0.001 
EnKF       10  PertObs  2              |  0.28    Â±0.1     0.32    Â±0.2   
EnKF        8  Sqrt     1.01           |  0.03519 Â±0.0009  0.02528 Â±0.0008
EnKF        8  Sqrt     1.1            |  0.03501 Â±0.0009  0.02528 Â±0.0008
EnKF        8  Sqrt     2              |  0.3     Â±0.2     0.34    Â±0.2   
EnKF       10  Sqrt     1.01           |  0.0372  Â±0.001   0.02664 Â±0.0008
EnKF       10  Sqrt     1.1            |  0.0369  Â±0.001   0.0268  Â±0.001 
EnKF       10  Sqrt     2              |  0.32    Â±0.2     0.34    Â±0.2   
EnKF_N      8           1              |  0.03519 Â±0.0009  0.02528 Â±0.0008
EnKF_N     10           1              |  0.0372  Â±0.002   0.02664 Â±0.0008
LETKF       8           1.01        1  |  0.0352  Â±0.0008  0.02504 Â±0.0008
LETKF       8           1.01        4  |  0.03501 Â±0.0009  0.02504 Â±0.0008
LETKF       8           1.01       10  |  0.03492 Â±0.0009  0.02512 Â±0.0008
LETKF       8           1.01       40  |  0.03519 Â±0.0009  0.02528 Â±0.0008
LETKF       8           1.1         1  |  0.03501 Â±0.0009  0.02496 Â±0.0008
LETKF       8           1.1         4  |  0.03465 Â±0.0009  0.02488 Â±0.0008
LETKF       8           1.1        10  |  0.03456 Â±0.0009  0.02504 Â±0.0008
LETKF       8           1.1        40  |  0.03501 Â±0.0009  0.02528 Â±0.0008
LETKF       8           2           1  |  0.32    Â±0.2     0.34    Â±0.2   
LETKF       8           2           4  |  0.32    Â±0.2     0.34    Â±0.2   
LETKF       8           2          10  |  0.3     Â±0.2     0.34    Â±0.2   
LETKF       8           2          40  |  0.3     Â±0.2     0.34    Â±0.2   
LETKF      10           1.01        1  |  0.0374  Â±0.002   0.0264  Â±0.0008
LETKF      10           1.01        4  |  0.037   Â±0.002   0.0264  Â±0.0008
LETKF      10           1.01       10  |  0.037   Â±0.001   0.02648 Â±0.0008
LETKF      10           1.01       40  |  0.0372  Â±0.001   0.02664 Â±0.0008
LETKF      10           1.1         1  |  0.0372  Â±0.002   0.02632 Â±0.0008
LETKF      10           1.1         4  |  0.0367  Â±0.001   0.0264  Â±0.001 
LETKF      10           1.1        10  |  0.0365  Â±0.001   0.0265  Â±0.001 
LETKF      10           1.1        40  |  0.0369  Â±0.001   0.0268  Â±0.001 
LETKF      10           2           1  |  0.34    Â±0.2     0.34    Â±0.2   
LETKF      10           2           4  |  0.32    Â±0.2     0.34    Â±0.2   
LETKF      10           2          10  |  0.32    Â±0.2     0.34    Â±0.2   
LETKF      10           2          40  |  0.32    Â±0.2     0.34    Â±0.2   
"""
_print(xps, "rmse.a", dict(outer="N",inner="seed"))

##
old = """Averages in time only (=> the 1Ïƒ estimates may be unreliable).

[43mTable for da_method='Climatology'[0m
seed   F  â‘Š  rmse.a Â±1Ïƒ
----  --  -  -----------
3000   8  |    0.78 Â±0.2
3000  10  |    0.96 Â±0.3
3001   8  |    0.78 Â±0.2
3001  10  |    0.96 Â±0.3

[43mTable for da_method='OptInterp'[0m
seed   F  â‘Š  rmse.a Â±1Ïƒ
----  --  -  ------------
3000   8  |   0.096 Â±0.03
3000  10  |   0.098 Â±0.02
3001   8  |   0.192 Â±0.03
3001  10  |   0.195 Â±0.03

[43mTable for da_method='Var3D'[0m
seed   F   xB  â‘Š  rmse.a Â±1Ïƒ
----  --  ---  -  ------------
3000   8  0.1  |   0.18  Â±0.02
3000   8  0.2  |   0.28  Â±0.02
3000   8  0.4  |   0.398 Â±0.02
3000  10  0.1  |   0.189 Â±0.03
3000  10  0.2  |   0.291 Â±0.03
3000  10  0.4  |   0.404 Â±0.02
3001   8  0.1  |   0.172 Â±0.02
3001   8  0.2  |   0.268 Â±0.02
3001   8  0.4  |   0.386 Â±0.01
3001  10  0.1  |   0.176 Â±0.02
3001  10  0.2  |   0.274 Â±0.02
3001  10  0.4  |   0.39  Â±0.01

[43mTable for da_method='EnKF'[0m
                            ______N=10_____  _______20______  _______50______
seed   F  upd_a    infl  â‘Š   rmse.a Â±1Ïƒ       rmse.a Â±1Ïƒ       rmse.a Â±1Ïƒ
----  --  -------  ----  -  ---------------  ---------------  ---------------
3000   8  PertObs  1.01  |  0.03708 Â±0.0009  0.03591 Â±0.0009  0.03519 Â±0.0009
3000   8  PertObs  1.1   |  0.0384  Â±0.002   0.0364  Â±0.001   0.03501 Â±0.0009
3000   8  PertObs  2     |  0.192   Â±0.08    0.25    Â±0.1     0.27    Â±0.1   
3000  10  PertObs  1.01  |  0.0394  Â±0.002   0.038   Â±0.002   0.0372  Â±0.001 
3000  10  PertObs  1.1   |  0.0412  Â±0.004   0.0386  Â±0.002   0.0369  Â±0.001 
3000  10  PertObs  2     |  0.184   Â±0.08    0.25    Â±0.1     0.28    Â±0.1   
3001   8  PertObs  1.01  |  0.0277  Â±0.001   0.026   Â±0.0008  0.02528 Â±0.0008
3001   8  PertObs  1.1   |  0.0285  Â±0.001   0.0261  Â±0.0009  0.02536 Â±0.0008
3001   8  PertObs  2     |  0.186   Â±0.06    0.207   Â±0.09    0.31    Â±0.1   
3001  10  PertObs  1.01  |  0.02907 Â±0.0009  0.02745 Â±0.0009  0.02664 Â±0.0008
3001  10  PertObs  1.1   |  0.0308  Â±0.002   0.0276  Â±0.001   0.0269  Â±0.001 
3001  10  PertObs  2     |  0.196   Â±0.07    0.216   Â±0.09    0.32    Â±0.2   
3000   8  Sqrt     1.01  |  0.03717 Â±0.0009  0.036   Â±0.0008  0.03519 Â±0.0009
3000   8  Sqrt     1.1   |  0.0384  Â±0.002   0.0363  Â±0.001   0.03501 Â±0.0009
3000   8  Sqrt     2     |  0.23    Â±0.1     0.27    Â±0.1     0.3     Â±0.2   
3000  10  Sqrt     1.01  |  0.0396  Â±0.002   0.038   Â±0.002   0.0372  Â±0.001 
3000  10  Sqrt     1.1   |  0.0412  Â±0.004   0.0384  Â±0.002   0.0369  Â±0.001 
3000  10  Sqrt     2     |  0.23    Â±0.1     0.28    Â±0.1     0.32    Â±0.2   
3001   8  Sqrt     1.01  |  0.0277  Â±0.001   0.02608 Â±0.0008  0.02528 Â±0.0008
3001   8  Sqrt     1.1   |  0.0281  Â±0.001   0.0261  Â±0.0009  0.02528 Â±0.0008
3001   8  Sqrt     2     |  0.2     Â±0.08    0.26    Â±0.1     0.34    Â±0.2   
3001  10  Sqrt     1.01  |  0.02907 Â±0.0009  0.02745 Â±0.0009  0.02664 Â±0.0008
3001  10  Sqrt     1.1   |  0.03    Â±0.002   0.0277  Â±0.001   0.0268  Â±0.001 
3001  10  Sqrt     2     |  0.208   Â±0.08    0.26    Â±0.1     0.34    Â±0.2   

[43mTable for da_method='EnKF_N'[0m
             ______N=10_____  _______20______  _______50______
seed   F  â‘Š   rmse.a Â±1Ïƒ       rmse.a Â±1Ïƒ       rmse.a Â±1Ïƒ
----  --  -  ---------------  ---------------  ---------------
3000   8  |  0.03717 Â±0.0009  0.036   Â±0.0008  0.03519 Â±0.0009
3000  10  |  0.0394  Â±0.002   0.038   Â±0.002   0.0372  Â±0.002 
3001   8  |  0.0277  Â±0.001   0.02608 Â±0.0008  0.02528 Â±0.0008
3001  10  |  0.02907 Â±0.0009  0.02745 Â±0.0009  0.02664 Â±0.0008
"""
_print(xps_shorter, "rmse.a", dict(outer="da_method",inner="N"))

##
old = """Averages in time only (=> the 1Ïƒ estimates may be unreliable).

[43mTable for da_method='Climatology'[0m
seed   F  â‘Š  rmse.a Â±1Ïƒ  â˜  âœ“
----  --  -  ---------------
3000   8  |  0.777  Â±nan 0 1
3000  10  |  0.9723 Â±nan 0 1
3001   8  |  0.778  Â±nan 0 1
3001  10  |  0.9734 Â±nan 0 1

[43mTable for da_method='OptInterp'[0m
seed   F  â‘Š   rmse.a Â±1Ïƒ  â˜  âœ“
----  --  -  ----------------
3000   8  |  0.09469 Â±nan 0 1
3000  10  |  0.09856 Â±nan 0 1
3001   8  |  0.1924  Â±nan 0 1
3001  10  |  0.1954  Â±nan 0 1

[43mTable for da_method='Var3D'[0m
seed   F   xB  â‘Š  rmse.a Â±1Ïƒ  â˜  âœ“
----  --  ---  -  ---------------
3000   8  0.1  |  0.1794 Â±nan 0 1
3000   8  0.2  |  0.2807 Â±nan 0 1
3000   8  0.4  |  0.3975 Â±nan 0 1
3000  10  0.1  |  0.1877 Â±nan 0 1
3000  10  0.2  |  0.2902 Â±nan 0 1
3000  10  0.4  |  0.4049 Â±nan 0 1
3001   8  0.1  |  0.1711 Â±nan 0 1
3001   8  0.2  |  0.2681 Â±nan 0 1
3001   8  0.4  |  0.3864 Â±nan 0 1
3001  10  0.1  |  0.1767 Â±nan 0 1
3001  10  0.2  |  0.2737 Â±nan 0 1
3001  10  0.4  |  0.3902 Â±nan 0 1

[43mTable for da_method='EnKF'[0m
                            ______N=10______  _______20_______  _______50_______
seed   F  upd_a    infl  â‘Š   rmse.a Â±1Ïƒ  â˜  âœ“   rmse.a Â±1Ïƒ  â˜  âœ“   rmse.a Â±1Ïƒ  â˜  âœ“
----  --  -------  ----  -  ----------------  ----------------  ----------------
3000   8  PertObs  1.01  |  0.03704 Â±nan 0 1  0.03594 Â±nan 0 1  0.03519 Â±nan 0 1
3000   8  PertObs  1.1   |  0.0384  Â±nan 0 1  0.03638 Â±nan 0 1  0.03503 Â±nan 0 1
3000   8  PertObs  2     |  0.1885  Â±nan 0 1  0.2527  Â±nan 0 1  0.2733  Â±nan 0 1
3000  10  PertObs  1.01  |  0.03936 Â±nan 0 1  0.03801 Â±nan 0 1  0.03722 Â±nan 0 1
3000  10  PertObs  1.1   |  0.04113 Â±nan 0 1  0.0386  Â±nan 0 1  0.03691 Â±nan 0 1
3000  10  PertObs  2     |  0.1848  Â±nan 0 1  0.2508  Â±nan 0 1  0.2817  Â±nan 0 1
3001   8  PertObs  1.01  |  0.02768 Â±nan 0 1  0.02604 Â±nan 0 1  0.02528 Â±nan 0 1
3001   8  PertObs  1.1   |  0.02854 Â±nan 0 1  0.02608 Â±nan 0 1  0.02534 Â±nan 0 1
3001   8  PertObs  2     |  0.1882  Â±nan 0 1  0.2115  Â±nan 0 1  0.3144  Â±nan 0 1
3001  10  PertObs  1.01  |  0.02908 Â±nan 0 1  0.02741 Â±nan 0 1  0.02664 Â±nan 0 1
3001  10  PertObs  1.1   |  0.03085 Â±nan 0 1  0.02756 Â±nan 0 1  0.02694 Â±nan 0 1
3001  10  PertObs  2     |  0.1933  Â±nan 0 1  0.2194  Â±nan 0 1  0.3229  Â±nan 0 1
3000   8  Sqrt     1.01  |  0.03717 Â±nan 0 1  0.03597 Â±nan 0 1  0.03517 Â±nan 0 1
3000   8  Sqrt     1.1   |  0.03847 Â±nan 0 1  0.0363  Â±nan 0 1  0.03505 Â±nan 0 1
3000   8  Sqrt     2     |  0.2272  Â±nan 0 1  0.2711  Â±nan 0 1  0.3084  Â±nan 0 1
3000  10  Sqrt     1.01  |  0.03953 Â±nan 0 1  0.03805 Â±nan 0 1  0.03719 Â±nan 0 1
3000  10  Sqrt     1.1   |  0.04116 Â±nan 0 1  0.03839 Â±nan 0 1  0.03692 Â±nan 0 1
3000  10  Sqrt     2     |  0.2296  Â±nan 0 1  0.2767  Â±nan 0 1  0.3141  Â±nan 0 1
3001   8  Sqrt     1.01  |  0.02767 Â±nan 0 1  0.02605 Â±nan 0 1  0.02528 Â±nan 0 1
3001   8  Sqrt     1.1   |  0.02813 Â±nan 0 1  0.0261  Â±nan 0 1  0.02531 Â±nan 0 1
3001   8  Sqrt     2     |  0.201   Â±nan 0 1  0.2575  Â±nan 0 1  0.3376  Â±nan 0 1
3001  10  Sqrt     1.01  |  0.02904 Â±nan 0 1  0.02744 Â±nan 0 1  0.02663 Â±nan 0 1
3001  10  Sqrt     1.1   |  0.03004 Â±nan 0 1  0.02766 Â±nan 0 1  0.02685 Â±nan 0 1
3001  10  Sqrt     2     |  0.2043  Â±nan 0 1  0.2599  Â±nan 0 1  0.343   Â±nan 0 1

[43mTable for da_method='EnKF_N'[0m
             ______N=10______  _______20_______  _______50_______
seed   F  â‘Š   rmse.a Â±1Ïƒ  â˜  âœ“   rmse.a Â±1Ïƒ  â˜  âœ“   rmse.a Â±1Ïƒ  â˜  âœ“
----  --  -  ----------------  ----------------  ----------------
3000   8  |  0.03713 Â±nan 0 1  0.03597 Â±nan 0 1  0.0352  Â±nan 0 1
3000  10  |  0.03947 Â±nan 0 1  0.03805 Â±nan 0 1  0.03724 Â±nan 0 1
3001   8  |  0.02768 Â±nan 0 1  0.02607 Â±nan 0 1  0.02529 Â±nan 0 1
3001  10  |  0.02904 Â±nan 0 1  0.02746 Â±nan 0 1  0.02663 Â±nan 0 1
"""
_print(xps_shorter, "rmse.a", dict(outer="da_method",inner="N",mean=()))

##
old = """Averages (in time and) over ('seed', 'infl').

[43mTable for da_method='Climatology'[0m
 F  â‘Š   rmse.a Â±1Ïƒ     â˜  âœ“
--  -  -------------------
 8  |  0.7775  Â±0.0005 0 2
10  |  0.97285 Â±0.0005 0 2

[43mTable for da_method='OptInterp'[0m
 F  â‘Š  rmse.a Â±1Ïƒ   â˜  âœ“
--  -  ----------------
 8  |   0.145 Â±0.05 0 2
10  |   0.145 Â±0.05 0 2

[43mTable for da_method='Var3D'[0m
 F   xB  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“
--  ---  -  -----------------
 8  0.1  |  0.1752 Â±0.004 0 2
 8  0.2  |  0.2742 Â±0.006 0 2
 8  0.4  |  0.3918 Â±0.006 0 2
10  0.1  |  0.1824 Â±0.006 0 2
10  0.2  |  0.2816 Â±0.008 0 2
10  0.4  |  0.3976 Â±0.007 0 2

[43mTable for da_method='EnKF'[0m
                ______N=10______  _______20_______  _______50_______
 F  upd_a    â‘Š  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ   â˜  âœ“
--  -------  -  ----------------  ----------------  ----------------
 8  PertObs  |   0.084 Â±0.03 0 6    0.1  Â±0.04 0 6   0.12  Â±0.06 0 6
10  PertObs  |   0.087 Â±0.03 0 6    0.1  Â±0.04 0 6   0.12  Â±0.06 0 6
 8  Sqrt     |   0.092 Â±0.04 0 6    0.11 Â±0.05 0 6   0.126 Â±0.06 0 6
10  Sqrt     |   0.096 Â±0.04 0 6    0.11 Â±0.05 0 6   0.132 Â±0.06 0 6

[43mTable for da_method='EnKF_N'[0m
       _______N=10______  ________20_______  ________50_______
 F  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
--  -  -----------------  -----------------  -----------------
 8  |  0.0325 Â±0.005 0 2   0.031 Â±0.005 0 2   0.03  Â±0.005 0 2
10  |  0.0345 Â±0.005 0 2   0.033 Â±0.005 0 2   0.032 Â±0.005 0 2
"""
_print(xps_shorter, "rmse.a", dict(outer="da_method",inner="N",mean=("seed","infl")))

##
old = """Averages (in time and) over seed.

[43mTable for da_method='Climatology'[0m
 F  â‘Š   rmse.a Â±1Ïƒ     â˜  âœ“
--  -  -------------------
 8  |  0.7775  Â±0.0005 0 2
10  |  0.97285 Â±0.0005 0 2

[43mTable for da_method='OptInterp'[0m
 F  â‘Š  rmse.a Â±1Ïƒ   â˜  âœ“
--  -  ----------------
 8  |   0.145 Â±0.05 0 2
10  |   0.145 Â±0.05 0 2

[43mTable for da_method='Var3D'[0m
 F   xB  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“
--  ---  -  -----------------
 8  0.1  |  0.1752 Â±0.004 0 2
 8  0.2  |  0.2742 Â±0.006 0 2
 8  0.4  |  0.3918 Â±0.006 0 2
10  0.1  |  0.1824 Â±0.006 0 2
10  0.2  |  0.2816 Â±0.008 0 2
10  0.4  |  0.3976 Â±0.007 0 2

[43mTable for da_method='EnKF'[0m
 F  upd_a     N  infl  â‘Š   rmse.a Â±1Ïƒ     â˜  âœ“
--  -------  --  ----  -  -------------------
 8  PertObs  10  1.01  |  0.0325  Â±0.005  0 2
 8  PertObs  10  1.1   |  0.0335  Â±0.005  0 2
 8  PertObs  10  2     |  0.18836 Â±0.0002 0 2
 8  PertObs  20  1.01  |  0.031   Â±0.005  0 2
 8  PertObs  20  1.1   |  0.031   Â±0.005  0 2
 8  PertObs  20  2     |  0.232   Â±0.02   0 2
 8  PertObs  50  1.01  |  0.03    Â±0.005  0 2
 8  PertObs  50  1.1   |  0.03    Â±0.005  0 2
 8  PertObs  50  2     |  0.294   Â±0.02   0 2
10  PertObs  10  1.01  |  0.034   Â±0.005  0 2
10  PertObs  10  1.1   |  0.036   Â±0.005  0 2
10  PertObs  10  2     |  0.1892  Â±0.004  0 2
10  PertObs  20  1.01  |  0.0325  Â±0.005  0 2
10  PertObs  20  1.1   |  0.033   Â±0.006  0 2
10  PertObs  20  2     |  0.236   Â±0.02   0 2
10  PertObs  50  1.01  |  0.032   Â±0.005  0 2
10  PertObs  50  1.1   |  0.032   Â±0.005  0 2
10  PertObs  50  2     |  0.302   Â±0.02   0 2
 8  Sqrt     10  1.01  |  0.0325  Â±0.005  0 2
 8  Sqrt     10  1.1   |  0.0335  Â±0.005  0 2
 8  Sqrt     10  2     |  0.214   Â±0.01   0 2
 8  Sqrt     20  1.01  |  0.031   Â±0.005  0 2
 8  Sqrt     20  1.1   |  0.031   Â±0.005  0 2
 8  Sqrt     20  2     |  0.2646  Â±0.007  0 2
 8  Sqrt     50  1.01  |  0.03    Â±0.005  0 2
 8  Sqrt     50  1.1   |  0.03    Â±0.005  0 2
 8  Sqrt     50  2     |  0.323   Â±0.01   0 2
10  Sqrt     10  1.01  |  0.0345  Â±0.005  0 2
10  Sqrt     10  1.1   |  0.0354  Â±0.006  0 2
10  Sqrt     10  2     |  0.217   Â±0.01   0 2
10  Sqrt     20  1.01  |  0.0325  Â±0.005  0 2
10  Sqrt     20  1.1   |  0.033   Â±0.005  0 2
10  Sqrt     20  2     |  0.268   Â±0.008  0 2
10  Sqrt     50  1.01  |  0.032   Â±0.005  0 2
10  Sqrt     50  1.1   |  0.032   Â±0.005  0 2
10  Sqrt     50  2     |  0.329   Â±0.01   0 2

[43mTable for da_method='EnKF_N'[0m
 F   N  â‘Š  rmse.a Â±1Ïƒ    â˜  âœ“
--  --  -  -----------------
 8  10  |  0.0325 Â±0.005 0 2
 8  20  |  0.031  Â±0.005 0 2
 8  50  |  0.03   Â±0.005 0 2
10  10  |  0.0345 Â±0.005 0 2
10  20  |  0.033  Â±0.005 0 2
10  50  |  0.032  Â±0.005 0 2
"""
_print(xps_shorter, "rmse.a", dict(outer="da_method",mean=("seed")))

##
old = """Averages in time only (=> the 1Ïƒ estimates may be unreliable).

[43mTable for da_method='Climatology'[0m
seed   F  â‘Š  rmse.a Â±1Ïƒ
----  --  -  -----------
3000   8  |    0.78 Â±0.2
3000  10  |    0.96 Â±0.3
3001   8  |    0.78 Â±0.2
3001  10  |    0.96 Â±0.3

[43mTable for da_method='OptInterp'[0m
seed   F  â‘Š  rmse.a Â±1Ïƒ
----  --  -  ------------
3000   8  |   0.096 Â±0.03
3000  10  |   0.098 Â±0.02
3001   8  |   0.192 Â±0.03
3001  10  |   0.195 Â±0.03

[43mTable for da_method='Var3D'[0m
seed   F   xB  â‘Š  rmse.a Â±1Ïƒ
----  --  ---  -  ------------
3000   8  0.1  |   0.18  Â±0.02
3000   8  0.2  |   0.28  Â±0.02
3000   8  0.4  |   0.398 Â±0.02
3000  10  0.1  |   0.189 Â±0.03
3000  10  0.2  |   0.291 Â±0.03
3000  10  0.4  |   0.404 Â±0.02
3001   8  0.1  |   0.172 Â±0.02
3001   8  0.2  |   0.268 Â±0.02
3001   8  0.4  |   0.386 Â±0.01
3001  10  0.1  |   0.176 Â±0.02
3001  10  0.2  |   0.274 Â±0.02
3001  10  0.4  |   0.39  Â±0.01

[43mTable for da_method='EnKF'[0m
seed   F  upd_a     N  infl  â‘Š   rmse.a Â±1Ïƒ
----  --  -------  --  ----  -  ---------------
3000   8  PertObs  10  1.01  |  0.03708 Â±0.0009
3000   8  PertObs  10  1.1   |  0.0384  Â±0.002 
3000   8  PertObs  10  2     |  0.192   Â±0.08  
3000   8  PertObs  20  1.01  |  0.03591 Â±0.0009
3000   8  PertObs  20  1.1   |  0.0364  Â±0.001 
3000   8  PertObs  20  2     |  0.25    Â±0.1   
3000   8  PertObs  50  1.01  |  0.03519 Â±0.0009
3000   8  PertObs  50  1.1   |  0.03501 Â±0.0009
3000   8  PertObs  50  2     |  0.27    Â±0.1   
3000  10  PertObs  10  1.01  |  0.0394  Â±0.002 
3000  10  PertObs  10  1.1   |  0.0412  Â±0.004 
3000  10  PertObs  10  2     |  0.184   Â±0.08  
3000  10  PertObs  20  1.01  |  0.038   Â±0.002 
3000  10  PertObs  20  1.1   |  0.0386  Â±0.002 
3000  10  PertObs  20  2     |  0.25    Â±0.1   
3000  10  PertObs  50  1.01  |  0.0372  Â±0.001 
3000  10  PertObs  50  1.1   |  0.0369  Â±0.001 
3000  10  PertObs  50  2     |  0.28    Â±0.1   
3001   8  PertObs  10  1.01  |  0.0277  Â±0.001 
3001   8  PertObs  10  1.1   |  0.0285  Â±0.001 
3001   8  PertObs  10  2     |  0.186   Â±0.06  
3001   8  PertObs  20  1.01  |  0.026   Â±0.0008
3001   8  PertObs  20  1.1   |  0.0261  Â±0.0009
3001   8  PertObs  20  2     |  0.207   Â±0.09  
3001   8  PertObs  50  1.01  |  0.02528 Â±0.0008
3001   8  PertObs  50  1.1   |  0.02536 Â±0.0008
3001   8  PertObs  50  2     |  0.31    Â±0.1   
3001  10  PertObs  10  1.01  |  0.02907 Â±0.0009
3001  10  PertObs  10  1.1   |  0.0308  Â±0.002 
3001  10  PertObs  10  2     |  0.196   Â±0.07  
3001  10  PertObs  20  1.01  |  0.02745 Â±0.0009
3001  10  PertObs  20  1.1   |  0.0276  Â±0.001 
3001  10  PertObs  20  2     |  0.216   Â±0.09  
3001  10  PertObs  50  1.01  |  0.02664 Â±0.0008
3001  10  PertObs  50  1.1   |  0.0269  Â±0.001 
3001  10  PertObs  50  2     |  0.32    Â±0.2   
3000   8  Sqrt     10  1.01  |  0.03717 Â±0.0009
3000   8  Sqrt     10  1.1   |  0.0384  Â±0.002 
3000   8  Sqrt     10  2     |  0.23    Â±0.1   
3000   8  Sqrt     20  1.01  |  0.036   Â±0.0008
3000   8  Sqrt     20  1.1   |  0.0363  Â±0.001 
3000   8  Sqrt     20  2     |  0.27    Â±0.1   
3000   8  Sqrt     50  1.01  |  0.03519 Â±0.0009
3000   8  Sqrt     50  1.1   |  0.03501 Â±0.0009
3000   8  Sqrt     50  2     |  0.3     Â±0.2   
3000  10  Sqrt     10  1.01  |  0.0396  Â±0.002 
3000  10  Sqrt     10  1.1   |  0.0412  Â±0.004 
3000  10  Sqrt     10  2     |  0.23    Â±0.1   
3000  10  Sqrt     20  1.01  |  0.038   Â±0.002 
3000  10  Sqrt     20  1.1   |  0.0384  Â±0.002 
3000  10  Sqrt     20  2     |  0.28    Â±0.1   
3000  10  Sqrt     50  1.01  |  0.0372  Â±0.001 
3000  10  Sqrt     50  1.1   |  0.0369  Â±0.001 
3000  10  Sqrt     50  2     |  0.32    Â±0.2   
3001   8  Sqrt     10  1.01  |  0.0277  Â±0.001 
3001   8  Sqrt     10  1.1   |  0.0281  Â±0.001 
3001   8  Sqrt     10  2     |  0.2     Â±0.08  
3001   8  Sqrt     20  1.01  |  0.02608 Â±0.0008
3001   8  Sqrt     20  1.1   |  0.0261  Â±0.0009
3001   8  Sqrt     20  2     |  0.26    Â±0.1   
3001   8  Sqrt     50  1.01  |  0.02528 Â±0.0008
3001   8  Sqrt     50  1.1   |  0.02528 Â±0.0008
3001   8  Sqrt     50  2     |  0.34    Â±0.2   
3001  10  Sqrt     10  1.01  |  0.02907 Â±0.0009
3001  10  Sqrt     10  1.1   |  0.03    Â±0.002 
3001  10  Sqrt     10  2     |  0.208   Â±0.08  
3001  10  Sqrt     20  1.01  |  0.02745 Â±0.0009
3001  10  Sqrt     20  1.1   |  0.0277  Â±0.001 
3001  10  Sqrt     20  2     |  0.26    Â±0.1   
3001  10  Sqrt     50  1.01  |  0.02664 Â±0.0008
3001  10  Sqrt     50  1.1   |  0.0268  Â±0.001 
3001  10  Sqrt     50  2     |  0.34    Â±0.2   

[43mTable for da_method='EnKF_N'[0m
seed   F   N  â‘Š   rmse.a Â±1Ïƒ
----  --  --  -  ---------------
3000   8  10  |  0.03717 Â±0.0009
3000   8  20  |  0.036   Â±0.0008
3000   8  50  |  0.03519 Â±0.0009
3000  10  10  |  0.0394  Â±0.002 
3000  10  20  |  0.038   Â±0.002 
3000  10  50  |  0.0372  Â±0.002 
3001   8  10  |  0.0277  Â±0.001 
3001   8  20  |  0.02608 Â±0.0008
3001   8  50  |  0.02528 Â±0.0008
3001  10  10  |  0.02907 Â±0.0009
3001  10  20  |  0.02745 Â±0.0009
3001  10  50  |  0.02664 Â±0.0008
"""
_print(xps_shorter, "rmse.a", dict(outer="da_method"))

##
old = """Averages (in time and) over seed.

                           da_method='Climatology',N=None  OptInterp,None  Var3D,None  EnKF,10  EnKF,20  EnKF,50  EnKF_N,10  EnKF_N,20  EnKF_N,50
 F   xB  upd_a    infl  â‘Š  rmse.a                          rmse.a          rmse.a      rmse.a   rmse.a   rmse.a   rmse.a     rmse.a     rmse.a
--  ---  -------  ----  -  ------------------------------  --------------  ----------  -------  -------  -------  ---------  ---------  ---------
 8                      |  0.7775                          0.145                                                                              
10                      |  0.97285                         0.145                                                                              
 8  0.1                 |                                                  0.1752                                                             
 8  0.2                 |                                                  0.2742                                                             
 8  0.4                 |                                                  0.3918                                                             
10  0.1                 |                                                  0.1824                                                             
10  0.2                 |                                                  0.2816                                                             
10  0.4                 |                                                  0.3976                                                             
 8       PertObs  1.01  |                                                              0.0325   0.031    0.03                                 
 8       PertObs  1.1   |                                                              0.0335   0.031    0.03                                 
 8       PertObs  2     |                                                              0.18836  0.232    0.294                                
10       PertObs  1.01  |                                                              0.034    0.0325   0.032                                
10       PertObs  1.1   |                                                              0.036    0.033    0.032                                
10       PertObs  2     |                                                              0.1892   0.236    0.302                                
 8       Sqrt     1.01  |                                                              0.0325   0.031    0.03                                 
 8       Sqrt     1.1   |                                                              0.0335   0.031    0.03                                 
 8       Sqrt     2     |                                                              0.214    0.2646   0.323                                
10       Sqrt     1.01  |                                                              0.0345   0.0325   0.032                                
10       Sqrt     1.1   |                                                              0.0354   0.033    0.032                                
10       Sqrt     2     |                                                              0.217    0.268    0.329                                
 8                1     |                                                                                         0.0325     0.031      0.03  
10                1     |                                                                                         0.0345     0.033      0.032 
"""
_print(xps_shorter, "rmse.a", dict(inner=("da_method","N"),mean="seed"), subcols=False)

##
old = """Averages in time only (=> the 1Ïƒ estimates may be unreliable).

[43mTable for da_method='Climatology',seed=3000[0m
 F  â‘Š  rmse.a
--  -  ------
 8  |    0.78
10  |    0.96

[43mTable for da_method='Climatology',seed=3001[0m
 F  â‘Š  rmse.a
--  -  ------
 8  |    0.78
10  |    0.96

[43mTable for da_method='OptInterp',seed=3000[0m
 F  â‘Š  rmse.a
--  -  ------
 8  |   0.096
10  |   0.098

[43mTable for da_method='OptInterp',seed=3001[0m
 F  â‘Š  rmse.a
--  -  ------
 8  |   0.192
10  |   0.195

[43mTable for da_method='Var3D',seed=3000[0m
 F   xB  â‘Š  rmse.a
--  ---  -  ------
 8  0.1  |   0.18 
 8  0.2  |   0.28 
 8  0.4  |   0.398
10  0.1  |   0.189
10  0.2  |   0.291
10  0.4  |   0.404

[43mTable for da_method='Var3D',seed=3001[0m
 F   xB  â‘Š  rmse.a
--  ---  -  ------
 8  0.1  |   0.172
 8  0.2  |   0.268
 8  0.4  |   0.386
10  0.1  |   0.176
10  0.2  |   0.274
10  0.4  |   0.39 

[43mTable for da_method='EnKF',seed=3000[0m
                      __N=10_  ___20__  ___50__
 F  upd_a    infl  â‘Š   rmse.a   rmse.a   rmse.a
--  -------  ----  -  -------  -------  -------
 8  PertObs  1.01  |  0.03708  0.03591  0.03519
 8  PertObs  1.1   |  0.0384   0.0364   0.03501
 8  PertObs  2     |  0.192    0.25     0.27   
10  PertObs  1.01  |  0.0394   0.038    0.0372 
10  PertObs  1.1   |  0.0412   0.0386   0.0369 
10  PertObs  2     |  0.184    0.25     0.28   
 8  Sqrt     1.01  |  0.03717  0.036    0.03519
 8  Sqrt     1.1   |  0.0384   0.0363   0.03501
 8  Sqrt     2     |  0.23     0.27     0.3    
10  Sqrt     1.01  |  0.0396   0.038    0.0372 
10  Sqrt     1.1   |  0.0412   0.0384   0.0369 
10  Sqrt     2     |  0.23     0.28     0.32   

[43mTable for da_method='EnKF',seed=3001[0m
                      __N=10_  ___20__  ___50__
 F  upd_a    infl  â‘Š   rmse.a   rmse.a   rmse.a
--  -------  ----  -  -------  -------  -------
 8  PertObs  1.01  |  0.0277   0.026    0.02528
 8  PertObs  1.1   |  0.0285   0.0261   0.02536
 8  PertObs  2     |  0.186    0.207    0.31   
10  PertObs  1.01  |  0.02907  0.02745  0.02664
10  PertObs  1.1   |  0.0308   0.0276   0.0269 
10  PertObs  2     |  0.196    0.216    0.32   
 8  Sqrt     1.01  |  0.0277   0.02608  0.02528
 8  Sqrt     1.1   |  0.0281   0.0261   0.02528
 8  Sqrt     2     |  0.2      0.26     0.34   
10  Sqrt     1.01  |  0.02907  0.02745  0.02664
10  Sqrt     1.1   |  0.03     0.0277   0.0268 
10  Sqrt     2     |  0.208    0.26     0.34   

[43mTable for da_method='EnKF_N',seed=3000[0m
       __N=10_  __20__  ___50__
 F  â‘Š   rmse.a  rmse.a   rmse.a
--  -  -------  ------  -------
 8  |  0.03717   0.036  0.03519
10  |  0.0394    0.038  0.0372 

[43mTable for da_method='EnKF_N',seed=3001[0m
       __N=10_  ___20__  ___50__
 F  â‘Š   rmse.a   rmse.a   rmse.a
--  -  -------  -------  -------
 8  |  0.0277   0.02608  0.02528
10  |  0.02907  0.02745  0.02664
"""
_print(xps_shorter, "rmse.a", dict(outer=("da_method","seed"),inner="N"), subcols=False)


##
if "--replace" in sys.argv:
    new_code = orig_code[0:replacements[0].nOpen]

    for i,replacement in enumerate(replacements):

        replacement.lines[0] = 'old = """' + replacement.lines[0]
        new_code += replacement.lines

        try:
            nEnd = replacements[i+1].nOpen
        except IndexError:
            nEnd = len(orig_code)
        new_code += orig_code[replacement.nClose : nEnd]

    # Don't overwrite! This allows for diffing.
    with open(__file__+".new", "w") as F:
        for line in new_code:
            # F.write(line.rstrip()+"\n")
            F.write(line)

##
